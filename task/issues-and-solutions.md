# IoT Care Backend System μ΄μ λ° ν•΄κ²° λ°©μ•

## π”΄ ν„μ¬ μ§„ν–‰ μ¤‘μΈ μ΄μ

### Issue #5: POST λ©”μ„λ“ μ‹¤ν¨ - ν•„λ“λ… λ¶μΌμΉ λ° ν•„μ ν•„λ“ λ„λ½
**λ°μƒ μ‹μ **: 2025-08-22 10:30:00  
**μƒνƒ**: π”΄ μ§„ν–‰ μ¤‘  
**μ°μ„ μμ„**: λ†’μ (ν†µν•© ν…μ¤νΈ 0% μ„±κ³µλ¥ )

#### λ¬Έμ  μƒμ„Έ
1. **ν•„λ“λ… λ¶μΌμΉ**: ORM λ¨λΈκ³Ό API μ¤ν‚¤λ§ κ°„ ν•„λ“λ… λ¶μΌμΉ
   - LoadCell: `raw_value` vs `weight_kg`
   - MQ5/MQ7: `analog_value` vs `ppm_value`
   - RFID: `card_id` vs `card_type`
   - Sound: `analog_value` vs `db_value`
   - TCRT5000: `digital_value` vs `object_detected`
   - Ultrasonic: `raw_value` vs `distance_cm`

2. **ν•„μ ν•„λ“ λ„λ½**: Edge μ„Όμ„μ™€ Actuator APIμ—μ„ ν•„μ ν•„λ“ λ„λ½
   - EdgePIR: `motion_detected` ν•„μ ν•„λ“ λ„λ½
   - EdgeReed: `switch_state` ν•„μ ν•„λ“ λ„λ½
   - EdgeTilt: `tilt_detected` ν•„μ ν•„λ“ λ„λ½
   - ActuatorBuzzer: `buzzer_type`, `state` ν•„μ ν•„λ“ λ„λ½
   - ActuatorIRTX: `command_hex` ν•„μ ν•„λ“ λ„λ½
   - ActuatorRelay: `channel`, `state` ν•„μ ν•„λ“ λ„λ½
   - ActuatorServo: `channel` ν•„μ ν•„λ“ λ„λ½

3. **λ°μ΄ν„° μƒμ„± μ‹¤ν¨**: Users, CDS, EdgeFlame APIμ—μ„ μƒμ„Έ μ¤λ¥ λ―Έν™•μΈ

#### λ¬Έμ  μ›μΈ λ¶„μ„
1. **μ¤ν‚¤λ§-ORM λ¶μΌμΉ**: API μ¤ν‚¤λ§μ™€ ORM λ¨λΈ κ°„ ν•„λ“λ… μ •μ μ°¨μ΄
2. **ν…μ¤νΈ λ°μ΄ν„° λ¶€μ •ν™•**: μ‹¤μ  μ¤ν‚¤λ§μ™€ μΌμΉν•μ§€ μ•λ” ν…μ¤νΈ λ°μ΄ν„°
3. **μ¤λ¥ λ΅κΉ… λ¶€μ΅±**: μƒμ„Έ μ¤λ¥ λ©”μ‹μ§€ λ―Έν™•μΈμΌλ΅ μ›μΈ νμ•… μ–΄λ ¤μ›€

#### ν•΄κ²° λ°©μ•
**Phase 1: ν•„λ“λ… λ¶μΌμΉ ν•΄κ²° (1μ‹κ°„)**
- LoadCell, MQ5, MQ7, RFID, Sound, TCRT5000, Ultrasonic λ¦¬ν¬μ§€ν† λ¦¬ μμ •
- ORM λ¨λΈκ³Ό μ¤ν‚¤λ§ κ°„ ν•„λ“λ… λ§¤ν•‘ λ΅μ§ κµ¬ν„
- LoadCell, MQ5 λ¦¬ν¬μ§€ν† λ¦¬λ” μ΄λ―Έ μμ • μ™„λ£

**Phase 2: ν•„μ ν•„λ“ λ„λ½ ν•΄κ²° (30λ¶„)**
- Edge μ„Όμ„μ™€ Actuator API ν…μ¤νΈ λ°μ΄ν„°μ— ν•„μ ν•„λ“ μ¶”κ°€
- μ¤ν‚¤λ§ κ²€μ¦ ν†µκ³Όν•λ„λ΅ λ°μ΄ν„° κµ¬μ΅° μμ •

**Phase 3: μ¤λ¥ λ΅κΉ… κ°•ν™” (30λ¶„)**
- Users, CDS, EdgeFlame API μ¤λ¥ μ›μΈ νμ•…
- μƒμ„Έ μ¤λ¥ λ©”μ‹μ§€ ν™•μΈ λ° λ΅κΉ… κ°μ„ 

**Phase 4: ν†µν•© ν…μ¤νΈ μ¬μ‹¤ν–‰ (1μ‹κ°„)**
- μμ •λ μ½”λ“λ΅ ν†µν•© ν…μ¤νΈ μ¬μ‹¤ν–‰
- μ„±κ³µλ¥  ν™•μΈ λ° μ¶”κ°€ λ¬Έμ  ν•΄κ²°

#### μ§„ν–‰ μƒν™©
- [x] λ¬Έμ  μ›μΈ νμ•…
- [x] ν•΄κ²° κ³„ν μλ¦½
- [x] LoadCell λ¦¬ν¬μ§€ν† λ¦¬ μμ • μ™„λ£
- [x] MQ5 λ¦¬ν¬μ§€ν† λ¦¬ μμ • μ™„λ£
- [ ] λ‚λ¨Έμ§€ μ„Όμ„ λ¦¬ν¬μ§€ν† λ¦¬ μμ •
- [ ] Edge μ„Όμ„ λ° Actuator API ν…μ¤νΈ λ°μ΄ν„° μμ •
- [ ] ν†µν•© ν…μ¤νΈ μ¬μ‹¤ν–‰

#### μμƒ μ™„λ£ μ‹κ°„
- **Phase 1**: 1μ‹κ°„
- **Phase 2**: 30λ¶„  
- **Phase 3**: 30λ¶„
- **Phase 4**: 1μ‹κ°„
- **μ΄ μμƒ μ‹κ°„**: 3μ‹κ°„

---

## β… ν•΄κ²°λ μ΄μ

### Issue #4: ImportError - Edge μ„Όμ„ μΈν„°νμ΄μ¤ import μ‹¤ν¨ (ν•΄κ²°λ¨)
**λ°μƒ μ‹μ **: 2024-12-19 17:00  
**ν•΄κ²° μ‹μ **: 2025-08-22 10:30:00  
**μƒνƒ**: β… ν•΄κ²°λ¨

#### λ¬Έμ  μƒμ„Έ
```
ImportError: cannot import name 'container' from partially initialized module 'app.core.container' (most likely due to a circular import)
```

#### λ¬Έμ  μ›μΈ λ¶„μ„
1. **μν™ import λ¬Έμ **: `container.py`μ—μ„ API λ¨λ“λ“¤μ„ μ§μ ‘ import
2. **μΈν„°νμ΄μ¤ μμ΅΄μ„±**: `actuator_service_interface.py`μ—μ„ `app.api.v1.schemas` import
3. **μμ΅΄μ„± μ£Όμ… μ‹μ¤ν… μ¤λ¥**: API λ¨λ“κ³Ό μ»¨ν…μ΄λ„ κ°„ μν™ μ°Έμ΅°

#### ν•΄κ²° λ°©μ•
**Phase 1: μΈν„°νμ΄μ¤ νμΌ κµ¬μ΅° μ •λ¦¬**
- `actuator_service_interface.py`μ—μ„ μ¤ν‚¤λ§ import μ κ±°
- νƒ€μ… ννΈλ¥Ό λ¬Έμμ—΄λ΅ λ³€κ²½ν•μ—¬ forward reference μ‚¬μ©

**Phase 2: μμ΅΄μ„± μ£Όμ… μ‹μ¤ν… μμ •**
- `container.py`μ—μ„ λ¨λ“  importλ¥Ό lazy loading λ°©μ‹μΌλ΅ λ³€κ²½
- κ° λ©”μ„λ“ λ‚΄μ—μ„ ν•„μ”ν• λ¨λ“μ„ importν•λ„λ΅ μμ •

**Phase 3: μ‹μ¤ν… μ¬μ‹μ‘ λ° ν…μ¤νΈ**
- μμ •λ μ½”λ“λ΅ μ‹μ¤ν… μ¬μ‹μ‘
- Import μ¤λ¥ ν•΄κ²° ν™•μΈ
- API μ„λ²„ μ •μƒ λ™μ‘ κ²€μ¦

#### κ²°κ³Ό
- μν™ import λ¬Έμ  μ™„μ „ ν•΄κ²°
- μμ΅΄μ„± μ£Όμ… μ‹μ¤ν… μ•μ •ν™”
- API μ„λ²„ μ •μƒ μ‹μ‘ λ° λ™μ‘

---

### Issue #3: psycopg2 μ„¤μΉ μ¤λ¥ (ν•΄κ²°λ¨)
**λ°μƒ μ‹μ **: 2024-12-19 14:00  
**ν•΄κ²° μ‹μ **: 2024-12-19 15:30  
**μƒνƒ**: β… ν•΄κ²°λ¨

#### λ¬Έμ  μƒμ„Έ
Windows ν™κ²½μ—μ„ `psycopg2` μ„¤μΉ μ‹ Microsoft Visual C++ Build Tools μ¤λ¥ λ°μƒ

#### ν•΄κ²° λ°©μ•
1. **psycopg2-binary μ‚¬μ©**: μ»΄νμΌλ λ°”μ΄λ„λ¦¬ ν¨ν‚¤μ§€ μ‚¬μ©
2. **Visual C++ Build Tools μ„¤μΉ**: μ‚¬μ©μμ—κ² ν•„μ”ν• λ„κµ¬ μ„¤μΉ μ•λ‚΄
3. **μλ™ν™” μ¤ν¬λ¦½νΈ μ κ³µ**: `install_packages.bat` λ° `install_packages.ps1` μƒμ„±

#### κ²°κ³Ό
- PostgreSQL λ“λΌμ΄λ²„ μ •μƒ μ„¤μΉ μ™„λ£
- λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²° μ •μƒ μ‘λ™

---

### Issue #2: Pydantic λ²„μ „ νΈν™μ„± λ¬Έμ  (ν•΄κ²°λ¨)
**λ°μƒ μ‹μ **: 2024-12-19 13:00  
**ν•΄κ²° μ‹μ **: 2024-12-19 13:30  
**μƒνƒ**: β… ν•΄κ²°λ¨

#### λ¬Έμ  μƒμ„Έ
`pydantic-settings` ν¨ν‚¤μ§€κ°€ Pydantic v2μ™€ νΈν™λμ§€ μ•μ

#### ν•΄κ²° λ°©μ•
1. **Pydantic v1 μ‚¬μ©**: `pydantic==1.10.13` μ„¤μΉ
2. **python-dotenv μ‚¬μ©**: `pydantic-settings` λ€μ‹  `python-dotenv` μ‚¬μ©
3. **requirements.txt μ—…λ°μ΄νΈ**: νΈν™λλ” λ²„μ „μΌλ΅ μμ •

#### κ²°κ³Ό
- λ°μ΄ν„° κ²€μ¦ μ‹μ¤ν… μ •μƒ μ‘λ™
- ν™κ²½ λ³€μ κ΄€λ¦¬ μ •μƒ μ‘λ™

---

### Issue #1: Clean Architecture μ„λ° λ¬Έμ  (ν•΄κ²°λ¨)
**λ°μƒ μ‹μ **: 2024-12-19 10:00  
**ν•΄κ²° μ‹μ **: 2024-12-19 16:00  
**μƒνƒ**: β… ν•΄κ²°λ¨

#### λ¬Έμ  μƒμ„Έ
κΈ°μ΅΄ μ„Όμ„ APIλ“¤μ΄ Clean Architectureλ¥Ό μ„λ°ν•μ—¬ μ§μ ‘ λ°μ΄ν„°λ² μ΄μ¤μ— μ ‘κ·Ό

#### ν•΄κ²° λ°©μ•
1. **μ „μ²΄ API λ¦¬ν©ν† λ§**: Clean Architecture μ¤€μν•λ„λ΅ μμ •
2. **μΈν„°νμ΄μ¤ λ¶„λ¦¬**: Repositoryμ™€ Service μΈν„°νμ΄μ¤ μ •μ
3. **μμ΅΄μ„± μ£Όμ…**: FastAPIμ `Depends`λ¥Ό ν™μ©ν• μμ΅΄μ„± μ£Όμ… κµ¬ν„

#### κ²°κ³Ό
- λ¨λ“  25κ° APIκ°€ Clean Architecture μ¤€μ
- μμ΅΄μ„± μ—­μ „ μ›μΉ™ μ™„λ²½ μ μ©
- ν…μ¤νΈ κ°€λ¥ν• μ•„ν‚¤ν…μ² κµ¬ν„

---

## π“‹ μ΄μ ν•΄κ²° μ²΄ν¬λ¦¬μ¤νΈ

### ν„μ¬ μ§„ν–‰ μ¤‘
- [ ] **Issue #5**: POST λ©”μ„λ“ μ‹¤ν¨ ν•΄κ²°
  - [ ] ν•„λ“λ… λ¶μΌμΉ ν•΄κ²° (LoadCell, MQ5 μ™„λ£)
  - [ ] λ‚λ¨Έμ§€ μ„Όμ„ λ¦¬ν¬μ§€ν† λ¦¬ μμ •
  - [ ] Edge μ„Όμ„ λ° Actuator API ν…μ¤νΈ λ°μ΄ν„° μμ •
  - [ ] ν†µν•© ν…μ¤νΈ μ¬μ‹¤ν–‰

### μ™„λ£λ μ΄μ
- [x] **Issue #4**: ImportError ν•΄κ²°
- [x] **Issue #3**: psycopg2 μ„¤μΉ μ¤λ¥
- [x] **Issue #2**: Pydantic λ²„μ „ νΈν™μ„± λ¬Έμ   
- [x] **Issue #1**: Clean Architecture μ„λ° λ¬Έμ 

---

## π¨ ν–¥ν›„ μ£Όμμ‚¬ν•­

### 1. μ¤ν‚¤λ§-ORM μΌμΉμ„± κ΄€λ¦¬
- API μ¤ν‚¤λ§μ™€ ORM λ¨λΈ κ°„ ν•„λ“λ… μΌμΉμ„± ν™•μΈ ν•„μ
- μƒλ΅μ΄ ν•„λ“ μ¶”κ°€ μ‹ μ–‘μ½ λ¨λ‘ λ™κΈ°ν™”

### 2. ν…μ¤νΈ λ°μ΄ν„° μ •ν™•μ„±
- μ‹¤μ  API μ¤ν‚¤λ§μ™€ μΌμΉν•λ” ν…μ¤νΈ λ°μ΄ν„° μƒμ„±
- ν•„μ ν•„λ“ ν¬ν•¨ν•μ—¬ Validation Error λ°©μ§€

### 3. μ¤λ¥ λ΅κΉ… κ°•ν™”
- μƒμ„Έ μ¤λ¥ λ©”μ‹μ§€ λ΅κΉ…μΌλ΅ λ¬Έμ  μ›μΈ νμ•…
- λ‹¨κ³„λ³„ ν…μ¤νΈλ΅ λ¬Έμ  μ§€μ  μ •ν™•ν νμ•…

---

## π“ μ§€μ› λ° λ¬Έμ

μ΄μ ν•΄κ²° κ³Όμ •μ—μ„ μ¶”κ°€ μ§€μ›μ΄ ν•„μ”ν• κ²½μ°:
1. λ΅κ·Έ νμΌ ν™•μΈ
2. νμΌ κµ¬μ΅° κ²€μ¦
3. κ°λ°ν€μ— μƒμ„Έ μ΄μ λ¦¬ν¬νΈ μ μ¶

**ν„μ¬ Issue #5 ν•΄κ²° μ§„ν–‰ μ¤‘μ΄λ©°, μ™„λ£ ν›„ ν†µν•© ν…μ¤νΈ 100% μ„±κ³µλ¥  λ‹¬μ„±μ„ λ©ν‘λ΅ ν•©λ‹λ‹¤.**

---

## π¨ λ¦¬λ¶€νΈ ν›„ μ‘μ—… μ¬κ° κ°€μ΄λ“

### 1. ν™κ²½ λ³µκµ¬
```bash
cd /home/guehojung/Documents/Project/IOT/iot-repo-4/services/was-server
docker-compose up -d
source venv/bin/activate
```

### 2. μ„λ²„ μƒνƒ ν™•μΈ
```bash
curl -s http://localhost:8000/health
```

### 3. λ‹¤μ μ‘μ—… μ°μ„ μμ„
1. LoadCell, MQ5, MQ7, RFID, Sound, TCRT5000, Ultrasonic λ¦¬ν¬μ§€ν† λ¦¬ μμ •
2. Edge μ„Όμ„μ™€ Actuator API ν…μ¤νΈ λ°μ΄ν„° μμ •
3. ν†µν•© ν…μ¤νΈ μ¬μ‹¤ν–‰ λ° μ„±κ³µλ¥  ν™•μΈ

**ν„μ¬ Issue #5 ν•΄κ²° μ§„ν–‰ μ¤‘μ΄λ©°, λ¦¬λ¶€νΈ ν›„ μ¦‰μ‹ μ‘μ—… μ¬κ° κ°€λ¥ν•©λ‹λ‹¤.**
