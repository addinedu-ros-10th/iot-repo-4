# μ‚¬μ©μ κ΄€κ³„ λ° ν”„λ΅ν•„ API κµ¬μ¶• μ™„λ£ λ³΄κ³ μ„

**μ‘μ„±μΌ**: 2025-08-23  
**μ‘μ„±μ**: AI Assistant  
**ν”„λ΅μ νΈ**: IoT Repository 4 - WAS Server  
**μƒνƒ**: β… μ™„λ£

## π“‹ **κ°λ° μ”μ²­ λ‚΄μ©**

### **μ”μ²­μ‚¬ν•­**
- `user_relationships`μ™€ `user_profiles` ν…μ΄λΈ”μ— λ€ν• RESTful API μƒμ„±
- Clean Architecture, Dependency Injection, Inversion of Control κ°λ° λ°©λ²•λ΅  μ μ©
- μµκ·Ό ν•΄κ²°λ Pydantic v1 νΈν™μ„± λ° SQLAlchemy λ¬Έμ  λ°μν•μ—¬ API κΈ°λ¥μ— λ¬Έμ κ°€ μ—†λ„λ΅ κµ¬μ„±

### **μ κ³µλ SQL DDL**
- `user_relationships` ν…μ΄λΈ”: μ‚¬μ©μ κ°„μ κ΄€κ³„(λλ΄„, κ°€μ΅±, κ΄€λ¦¬) μ •μ
- `user_profiles` ν…μ΄λΈ”: μ‚¬μ©μμ μƒμ„Έ ν”„λ΅ν•„ λ° λλ΄„ μ„λΉ„μ¤ κ΄€λ ¨ μ •λ³΄

## π—οΈ **μ μ©λ κ°λ° λ°©λ²•λ΅ **

### **1. Clean Architecture**
- **λ„λ©”μΈ κ³„μΈµ**: λΉ„μ¦λ‹μ¤ μ—”ν‹°ν‹° λ° κ·μΉ™
- **μΈν„°νμ΄μ¤ κ³„μΈµ**: μ¶”μƒν™”λ κ³„μ•½ μ •μ
- **μΈν”„λΌ κ³„μΈµ**: κµ¬μ²΄μ μΈ κµ¬ν„μ²΄
- **μ μ¤μΌ€μ΄μ¤ κ³„μΈµ**: λΉ„μ¦λ‹μ¤ λ΅μ§ μ΅°ν•©

### **2. Dependency Injection (DI)**
- μμ΅΄μ„± μ£Όμ… μ»¨ν…μ΄λ„λ¥Ό ν†µν• κ²°ν•©λ„ κ°μ†
- ν…μ¤νΈ μ©μ΄μ„± λ° μ μ§€λ³΄μμ„± ν–¥μƒ
- Lazy loading ν¨ν„΄μΌλ΅ μν™ μ°Έμ΅° λ°©μ§€

### **3. Inversion of Control (IoC)**
- μ μ–΄μ μ—­μ „μ„ ν†µν• μ μ—°ν• μ„¤κ³„
- μΈν„°νμ΄μ¤ κΈ°λ° μμ΅΄μ„± κ΄€λ¦¬
- λ¨λ“ κ°„ κ²°ν•©λ„ μµμ†ν™”

## π“ **μƒλ΅ μƒμ„±λ νμΌ λ©λ΅**

### **λ„λ©”μΈ μ—”ν‹°ν‹° (2κ°)**
- `app/domain/entities/user_relationship.py` - μ‚¬μ©μ κ΄€κ³„ μ—”ν‹°ν‹°
- `app/domain/entities/user_profile.py` - μ‚¬μ©μ ν”„λ΅ν•„ μ—”ν‹°ν‹°

### **μΈν„°νμ΄μ¤ (4κ°)**
- `app/interfaces/repositories/user_relationship_repository.py` - μ‚¬μ©μ κ΄€κ³„ λ¦¬ν¬μ§€ν† λ¦¬ μΈν„°νμ΄μ¤
- `app/interfaces/repositories/user_profile_repository.py` - μ‚¬μ©μ ν”„λ΅ν•„ λ¦¬ν¬μ§€ν† λ¦¬ μΈν„°νμ΄μ¤
- `app/interfaces/services/user_relationship_service_interface.py` - μ‚¬μ©μ κ΄€κ³„ μ„λΉ„μ¤ μΈν„°νμ΄μ¤
- `app/interfaces/services/user_profile_service_interface.py` - μ‚¬μ©μ ν”„λ΅ν•„ μ„λΉ„μ¤ μΈν„°νμ΄μ¤

### **κµ¬ν„μ²΄ (4κ°)**
- `app/infrastructure/repositories/user_relationship_repository.py` - μ‚¬μ©μ κ΄€κ³„ λ¦¬ν¬μ§€ν† λ¦¬ κµ¬ν„μ²΄
- `app/infrastructure/repositories/user_profile_repository.py` - μ‚¬μ©μ ν”„λ΅ν•„ λ¦¬ν¬μ§€ν† λ¦¬ κµ¬ν„μ²΄
- `app/use_cases/user_relationship_service.py` - μ‚¬μ©μ κ΄€κ³„ μ„λΉ„μ¤ κµ¬ν„μ²΄
- `app/use_cases/user_profile_service.py` - μ‚¬μ©μ ν”„λ΅ν•„ μ„λΉ„μ¤ κµ¬ν„μ²΄

### **API κ³„μΈµ (2κ°)**
- `app/api/v1/user_relationships.py` - μ‚¬μ©μ κ΄€κ³„ API μ—”λ“ν¬μΈνΈ
- `app/api/v1/user_profiles.py` - μ‚¬μ©μ ν”„λ΅ν•„ API μ—”λ“ν¬μΈνΈ

## π”§ **μμ •λ κΈ°μ΅΄ νμΌ λ©λ΅**

### **λ°μ΄ν„°λ² μ΄μ¤ λ¨λΈ**
- `app/infrastructure/models.py` - UserRelationship, UserProfile ORM λ¨λΈ μ¶”κ°€

### **μ¤ν‚¤λ§ μ •μ**
- `app/api/v1/schemas.py` - μ‚¬μ©μ κ΄€κ³„ λ° ν”„λ΅ν•„ Pydantic μ¤ν‚¤λ§ μ¶”κ°€

### **μμ΅΄μ„± μ£Όμ…**
- `app/core/container.py` - μƒλ΅μ΄ μ„λΉ„μ¤μ™€ λ¦¬ν¬μ§€ν† λ¦¬ μμ΅΄μ„± μ£Όμ… μ„¤μ • μ¶”κ°€

### **API λΌμ°ν„° λ“±λ΅**
- `app/api/__init__.py` - μ‚¬μ©μ κ΄€κ³„ λ° ν”„λ΅ν•„ API λΌμ°ν„° λ“±λ΅

## π€ **κµ¬ν„λ API μ—”λ“ν¬μΈνΈ**

### **μ‚¬μ©μ κ΄€κ³„ API (`/api/user-relationships`)**
1. `POST /create` - κ΄€κ³„ μƒμ„±
2. `GET /{relationship_id}` - κ΄€κ³„ μ΅°ν
3. `GET /user/{user_id}` - μ‚¬μ©μλ³„ κ΄€κ³„ μ΅°ν
4. `GET /type/{relationship_type}` - κ΄€κ³„ μ ν•λ³„ μ΅°ν
5. `PUT /{relationship_id}/status` - μƒνƒ μ—…λ°μ΄νΈ
6. `DELETE /{relationship_id}` - κ΄€κ³„ μ‚­μ 
7. `GET /` - μ „μ²΄ κ΄€κ³„ λ©λ΅ (νμ΄μ§€λ„¤μ΄μ…)

### **μ‚¬μ©μ ν”„λ΅ν•„ API (`/api/user-profiles`)**
1. `POST /create/{user_id}` - ν”„λ΅ν•„ μƒμ„±
2. `GET /{user_id}` - ν”„λ΅ν•„ μ΅°ν
3. `PUT /{user_id}` - ν”„λ΅ν•„ μ—…λ°μ΄νΈ
4. `DELETE /{user_id}` - ν”„λ΅ν•„ μ‚­μ 
5. `GET /gender/{gender}` - μ„±λ³„λ³„ μ΅°ν
6. `GET /age-range/{min_age}/{max_age}` - λ‚μ΄ λ²”μ„λ³„ μ΅°ν
7. `GET /search/medical` - λ³‘λ ¥ κ²€μƒ‰
8. `GET /` - μ „μ²΄ ν”„λ΅ν•„ λ©λ΅ (νμ΄μ§€λ„¤μ΄μ…)

## β… **μ μ©λ μµκ·Ό λ¬Έμ  ν•΄κ²° μ‚¬ν•­**

### **1. Pydantic v1 νΈν™μ„±**
- `from_orm()` λ©”μ„λ“ μ‚¬μ©μΌλ΅ Pydantic v1 νΈν™μ„± ν™•λ³΄
- `orm_mode = True` μ„¤μ •μΌλ΅ ORM λ¨λΈ λ³€ν™ μ§€μ›

### **2. SQLAlchemy λΉ„λ™κΈ° μ²λ¦¬**
- `commit()`κ³Ό `refresh()`λ” λ™κΈ° λ©”μ„λ“λ΅ μ²λ¦¬ (await μ κ±°)
- `execute()` μΏΌλ¦¬λ” `await` μ‚¬μ©

### **3. API λΌμ°ν„° κ²½λ΅ κ΄€λ¦¬**
- prefix μ¤‘λ³µ μ„¤μ • λ°©μ§€λ΅ μ¬λ°”λ¥Έ API κ²½λ΅ λ§¤ν•‘
- `/api/user-relationships/user-relationships/create` ν•νƒμ μ¤‘λ³µ κ²½λ΅ λ¬Έμ  ν•΄κ²°

## π§ **ν…μ¤νΈ κ²°κ³Ό**

### **API λ“±λ΅ ν™•μΈ**
- β… Swagger UIμ—μ„ μƒ API μ •μƒ λ“±λ΅ ν™•μΈ
- β… OpenAPI μ¤ν‚¤λ§μ— user-relationships, user-profiles API ν¬ν•¨

### **κΈ°λ³Έ λ™μ‘ ν…μ¤νΈ**
- β… GET `/api/user-relationships/` - μ •μƒ μ‘λ‹µ (λΉ λ©λ΅)
- β… GET `/api/user-profiles/` - μ •μƒ μ‘λ‹µ (λΉ λ©λ΅)

### **μ—λ¬ μ²λ¦¬**
- β… μ΅΄μ¬ν•μ§€ μ•λ” λ°μ΄ν„° μ΅°ν μ‹ μ μ ν• μ—λ¬ μ‘λ‹µ
- β… μλ»λ μ…λ ¥ λ°μ΄ν„°μ— λ€ν• κ²€μ¦ μ—λ¬ μ²λ¦¬

## π“ **κµ¬ν„ μ™„λ£ ν„ν™©**

### **μ „μ²΄ μ§„ν–‰λ¥ **
- **λ©ν‘**: μ‚¬μ©μ κ΄€κ³„ λ° ν”„λ΅ν•„ API κµ¬μ¶• μ™„λ£
- **ν„μ¬ μ§„ν–‰λ¥ **: 100% μ™„λ£
- **μƒμ„±λ νμΌ**: 12κ°
- **μμ •λ νμΌ**: 4κ°
- **μ΄ μ‘μ—…λ‰**: 16κ° νμΌ

### **κµ¬ν„λ κΈ°λ¥**
- β… λ„λ©”μΈ μ—”ν‹°ν‹° λ° λΉ„μ¦λ‹μ¤ λ΅μ§
- β… λ¦¬ν¬μ§€ν† λ¦¬ ν¨ν„΄ λ° λ°μ΄ν„° μ ‘κ·Ό κ³„μΈµ
- β… μ„λΉ„μ¤ κ³„μΈµ λ° λΉ„μ¦λ‹μ¤ λ΅μ§ μ΅°ν•©
- β… API μ—”λ“ν¬μΈνΈ λ° HTTP λ©”μ„λ“
- β… μμ΅΄μ„± μ£Όμ… λ° μ—­μ „ μ μ–΄
- β… Swagger UI λ¬Έμ„ν™”
- β… μ—λ¬ μ²λ¦¬ λ° κ²€μ¦ λ΅μ§

## π― **λ‹¤μ λ‹¨κ³„ λ©ν‘**

### **1. Edge μ„Όμ„ API λ¬Έμ  ν•΄κ²°**
- Flame, PIR, Reed, Tilt API λ¬Έμ  νμ•…
- ν•„μ ν•„λ“ λ„λ½ λ¬Έμ  ν•΄κ²°
- μ¤ν‚¤λ§ λ¶μΌμΉ λ¬Έμ  ν•΄κ²°

### **2. Actuator API λ¬Έμ  ν•΄κ²°**
- Buzzer, IRTX, Relay, Servo API λ¬Έμ  νμ•…
- ν•„μ ν•„λ“ λ„λ½ λ¬Έμ  ν•΄κ²°
- μ¤ν‚¤λ§ λ¶μΌμΉ λ¬Έμ  ν•΄κ²°

### **3. ν†µν•© ν…μ¤νΈ 100% μ„±κ³µλ¥  λ‹¬μ„±**
- λ¨λ“  API μ—”λ“ν¬μΈνΈ μ •μƒ λ™μ‘ ν™•μΈ
- POST/GET/PUT/DELETE λ©”μ„λ“ μ •μƒ λ™μ‘ ν™•μΈ

## π” **κΈ°μ μ  νΉμ§•**

### **1. ν™•μ¥μ„±**
- Clean Architectureλ΅ μƒλ΅μ΄ κΈ°λ¥ μ¶”κ°€ μ©μ΄
- μΈν„°νμ΄μ¤ κΈ°λ° μ„¤κ³„λ΅ κµ¬ν„μ²΄ κµμ²΄ κ°€λ¥

### **2. μ μ§€λ³΄μμ„±**
- κ³„μΈµλ³„ μ±…μ„ λ¶„λ¦¬λ΅ μ½”λ“ μ΄ν•΄ λ° μμ • μ©μ΄
- μμ΅΄μ„± μ£Όμ…μΌλ΅ ν…μ¤νΈ λ° λ¨ν‚Ή μ©μ΄

### **3. μΌκ΄€μ„±**
- κΈ°μ΅΄ APIμ™€ λ™μΌν• ν¨ν„΄ μ μ©
- Pydantic v1 νΈν™μ„± μ μ§€
- SQLAlchemy λΉ„λ™κΈ° μ²λ¦¬ ν¨ν„΄ μΌκ΄€μ„±

## π“ **μ£Όμ” ν•™μµ λ‚΄μ©**

### **1. Clean Architecture κµ¬ν„**
- λ„λ©”μΈ, μΈν„°νμ΄μ¤, μΈν”„λΌ, μ μ¤μΌ€μ΄μ¤ κ³„μΈµ λ¶„λ¦¬ λ°©λ²•
- κ° κ³„μΈµμ μ±…μ„κ³Ό μμ΅΄μ„± κ΄€λ¦¬ λ°©λ²•

### **2. μμ΅΄μ„± μ£Όμ… ν¨ν„΄**
- FastAPIμ™€ SQLAlchemy ν™κ²½μ—μ„ DI/IoC κµ¬ν„ λ°©λ²•
- Lazy loadingμ„ ν†µν• μν™ μ°Έμ΅° λ°©μ§€ λ°©λ²•

### **3. API μ„¤κ³„ λ° κµ¬ν„**
- RESTful API μ„¤κ³„ μ›μΉ™ μ μ©
- Swagger UI λ¬Έμ„ν™” λ° μ‚¬μ©μ κ²½ν— κ°μ„ 
- μ—λ¬ μ²λ¦¬ λ° κ²€μ¦ λ΅μ§ κµ¬ν„

---

**μ‘μ„±μΌ**: 2025-08-23 15:30:00  
**μƒνƒ**: β… μ™„λ£  
**κ²€ν† μ**: AI Assistant
